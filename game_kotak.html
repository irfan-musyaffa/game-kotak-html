<!DOCTYPE html>
<html>
<head>
    <title>Menara Kotak Ajaib</title>
    <style>
        /* INI BAGIAN DANDANAN (CSS) */
        body { 
            background-color: #2c3e50; 
            text-align: center; 
            font-family: Arial, sans-serif;
            overflow: hidden; /* Biar gak ada scroll */
            touch-action: manipulation; /* Biar enak main di HP/Tablet */
        }
        
        h1 { color: white; margin-top: 10px; }
        
        #game-area {
            position: relative;
            width: 400px;
            height: 500px;
            margin: 0 auto;
            background-color: #34495e;
            border: 5px solid #ecf0f1;
            border-bottom: none;
            overflow: hidden;
        }

        /* Ini bentuk dasar kotaknya */
        .kotak {
            position: absolute;
            height: 30px;
            background-color: #e74c3c;
            border: 1px solid rgba(0,0,0,0.2);
            box-sizing: border-box;
        }

        #skor { color: yellow; font-size: 40px; font-weight: bold; }
        #pesan { color: white; margin-top: 5px; }
    </style>
</head>
<body onclick="stopBalok()"> <h1>MENARA KOTAK</h1>
    <div id="skor">0</div>
    <div id="game-area"></div>
    <div id="pesan">Klik layar / Spasi untuk main! ojo kalah</div>

    <script>
        const area = document.getElementById('game-area');
        const skorText = document.getElementById('skor');
        const pesanText = document.getElementById('pesan');

        let lebarAwal = 300; // Lebar kotak pertama
        let tinggiKotak = 30;
        let kecepatan = 2; // Makin besar makin cepat
        let arah = 1; // 1 ke kanan, -1 ke kiri
        let posisiSekarang = 0;
        let balokAktif = null;
        let lebarSekarang = lebarAwal;
        let posisiLantaiBawah = 0; // Posisi kiri kotak sebelumnya
        let level = 0;
        let gameJalan = false;
        let intervalGerak;

        // Fungsi buat bikin kotak baru
        function buatKotakBaru() {
            // Kalau sudah mentok atas, turunkan semua (biar gak penuh)
            if (level * tinggiKotak > 450) {
                Array.from(area.children).forEach(k => {
                    k.style.bottom = (parseInt(k.style.bottom) - tinggiKotak) + 'px';
                });
                level--;
            }

            balokAktif = document.createElement('div');
            balokAktif.className = 'kotak';
            balokAktif.style.width = lebarSekarang + 'px';
            balokAktif.style.height = tinggiKotak + 'px';
            balokAktif.style.bottom = (level * tinggiKotak) + 'px';
            
            // Warna ganti-ganti
            let warna = `hsl(${level * 20}, 70%, 50%)`;
            balokAktif.style.backgroundColor = warna;

            // Posisi awal (selalu dari pinggir kiri)
            posisiSekarang = 0;
            balokAktif.style.left = posisiSekarang + 'px';
            
            area.appendChild(balokAktif);
            
            // Mulai gerakkan
            arah = 1;
            clearInterval(intervalGerak);
            intervalGerak = setInterval(gerak, 10);
        }

        function gerak() {
            // Ubah posisi
            posisiSekarang += kecepatan * arah;
            balokAktif.style.left = posisiSekarang + 'px';

            // Kalau nabrak tembok kanan/kiri, balik arah
            if (posisiSekarang > (400 - lebarSekarang) || posisiSekarang < 0) {
                arah *= -1;
            }
        }

        function stopBalok() {
            // Kalau game belum mulai, mulai dulu
            if (!gameJalan) {
                gameJalan = true;
                pesanText.innerText = "Tekan Spasi / Klik untuk stop!";
                area.innerHTML = ''; // Bersihkan area
                level = 0;
                lebarSekarang = 300;
                posisiLantaiBawah = (400 - 300) / 2; // Tengah
                
                // Bikin lantai dasar (diam)
                let lantai = document.createElement('div');
                lantai.className = 'kotak';
                lantai.style.width = lebarSekarang + 'px';
                lantai.style.bottom = '0px';
                lantai.style.left = posisiLantaiBawah + 'px';
                lantai.style.backgroundColor = '#ecf0f1';
                area.appendChild(lantai);
                
                level++;
                buatKotakBaru();
                return;
            }

            clearInterval(intervalGerak); // Setop gerakan

            // HITUNG MATEMATIKA POTONG KUE
            let selisih = posisiSekarang - posisiLantaiBawah;
            
            // Kalau meleset banget (Game Over)
            if (Math.abs(selisih) >= lebarSekarang) {
                pesanText.innerText = "WAH RAISO DOLAN UUU.";
                gameJalan = false;
                balokAktif.style.backgroundColor = "gray";
                return;
            }

            // Kalau kena tapi geser dikit (Potong kotaknya)
            if (selisih != 0) {
                lebarSekarang -= Math.abs(selisih);
                if (selisih > 0) {
                    // Meleset ke kanan
                    posisiLantaiBawah = posisiSekarang; 
                } else {
                    // Meleset ke kiri, posisi lantai tetap yang lama tapi lebar kurang
                    posisiLantaiBawah = posisiLantaiBawah; 
                }
                balokAktif.style.width = lebarSekarang + 'px';
                balokAktif.style.left = posisiLantaiBawah + 'px'; // Rapikan posisi
            }

            skorText.innerText = level;
            kecepatan += 0.2; // Tambah ngebut dikit
            level++;
            posisiLantaiBawah = parseInt(balokAktif.style.left);
            
            buatKotakBaru();
        }

        // Biar bisa pakai tombol Spasi juga
        document.body.onkeydown = function(e) {
            if (e.code == "Space") {
                stopBalok();
            }
        }
    </script>
</body>
</html>